# サムネイル保存方式の比較

## 1. ファイル形式で保存（現在の実装）

### 概要
プロジェクトディレクトリ内の`thumbnails/`フォルダにJPEGタイルマップとして保存

### 保存構造
```
プロジェクトディレクトリ/
  └── thumbnails/
      └── {動画ハッシュ}/
          ├── tile_320x180_0000.jpg    (10x10 = 100枚のサムネイル)
          ├── tile_320x180_0001.jpg
          ├── tile_640x360_0000.jpg
          ├── tile_640x360_0001.jpg
          ├── tile_1280x720_0000.jpg
          └── keyframes.json
```

### メリット
✅ **プロジェクトファイルサイズが小さい** - JSONファイルにメタデータのみ保存  
✅ **読み込みが高速** - プロジェクトファイルの読み込み時に画像データを読み込まない  
✅ **メモリ効率が良い** - 必要な時だけ画像を読み込む  
✅ **編集が容易** - 画像ファイルを直接編集・削除可能  
✅ **バージョン管理に適している** - Gitなどで差分管理が可能  
✅ **複数プロジェクトで共有可能** - 同じ動画のサムネイルを再利用  
✅ **圧縮効率が良い** - JPEGタイルマップ形式でI/O効率が高い  

### デメリット
❌ **ファイル管理が必要** - プロジェクトファイルと一緒に移動する必要がある  
❌ **相対パスの管理** - プロジェクトファイルの場所が変わるとパス調整が必要  
❌ **削除時の注意** - プロジェクトファイルを削除する際にサムネイルも削除する必要がある  

### ストレージ使用量（例：30fps、10分の動画）
- キーフレーム数: 約600個（1秒間隔）
- 1サムネイル（320x180）: 約15-25KB（JPEG品質80%）
- タイルマップ（100枚/ファイル）: 約1.5-2.5MB/ファイル
- 3スケール合計: 約4.5-7.5MB

---

## 2. プロジェクトファイルに埋め込む案

### 概要
プロジェクトファイル（JSON）内にBase64エンコードされた画像データを直接埋め込む

### 保存構造
```json
{
  "thumbnailData": {
    "keyFrames": [0.0, 1.0, 2.0, ...],
    "scales": [
      {
        "size": "320x180",
        "thumbnails": [
          {
            "timePosition": 0.0,
            "imageData": "base64エンコードされたJPEGデータ..."
          },
          ...
        ]
      },
      ...
    ]
  }
}
```

### メリット
✅ **単一ファイル管理** - プロジェクトファイル1つですべて完結  
✅ **移動が簡単** - プロジェクトファイルをコピーするだけで完結  
✅ **バックアップが容易** - 1ファイルをバックアップするだけ  
✅ **相対パスの問題なし** - すべてがプロジェクトファイル内に含まれる  

### デメリット
❌ **プロジェクトファイルサイズが巨大** - 10分の動画で約5-10MBのJSONファイル  
❌ **読み込みが遅い** - プロジェクトファイルを開く際に全画像データをデコード  
❌ **メモリ使用量が大きい** - 全サムネイルを一度にメモリに読み込む  
❌ **JSONパースが重い** - Base64デコードとJSONパースのオーバーヘッド  
❌ **編集が困難** - 画像を変更するたびにプロジェクトファイル全体を再保存  
❌ **バージョン管理に不向き** - Gitで差分が巨大になり、マージが困難  
❌ **圧縮効率が悪い** - Base64エンコードで約33%サイズ増加  

### ストレージ使用量（例：30fps、10分の動画）
- キーフレーム数: 約600個（1秒間隔）
- 1サムネイル（320x180）: 約15-25KB（JPEG）
- Base64エンコード後: 約20-33KB（33%増加）
- 3スケール合計: 約36-60MB（JSONファイル内）

---

## 3. 推奨方式：ファイル形式で保存（現在の実装を改善）

### 理由
1. **パフォーマンス**: プロジェクトファイルの読み込みが高速
2. **スケーラビリティ**: 長い動画でもプロジェクトファイルサイズが小さい
3. **メモリ効率**: 必要な時だけ画像を読み込む
4. **開発効率**: デバッグや編集が容易

### 改善点
1. **プロジェクトディレクトリの確実な指定**
   - `TimelineViewModel`でプロジェクトディレクトリを取得してキャッシュに渡す
   - `AdvancedThumbnailProvider`でプロジェクトディレクトリを確実に使用

2. **相対パスの管理**
   - 保存時: プロジェクトファイルからの相対パスで保存
   - 読み込み時: プロジェクトファイルのディレクトリを基準に絶対パスに変換

3. **プロジェクト削除時のクリーンアップ**
   - プロジェクトファイル削除時に`thumbnails/`フォルダも削除する機能を追加

---

## 4. フレームサイズの推奨値

### 現在のサイズ
- 小: 80x45
- 中: 160x90（デフォルト）
- 大: 320x180

### 推奨サイズ（大きくする）
- 小: 160x90（ズームアウト用）
- 中: 320x180（標準）
- 大: 640x360（ズームイン用）

### さらに大きくする場合
- 小: 320x180
- 中: 640x360
- 大: 1280x720（HD解像度）

### ストレージ使用量の比較

| サイズ | JPEG品質80% | 600フレーム（10分） | 3スケール合計 |
|--------|------------|-------------------|--------------|
| 80x45 | ~3KB | ~1.8MB | ~5.4MB |
| 160x90 | ~8KB | ~4.8MB | ~14.4MB |
| **320x180** | **~20KB** | **~12MB** | **~36MB** |
| 640x360 | ~50KB | ~30MB | ~90MB |
| 1280x720 | ~120KB | ~72MB | ~216MB |

**推奨**: 320x180, 640x360, 1280x720 の3スケール（合計約36MB）
